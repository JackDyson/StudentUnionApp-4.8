@{
    ViewBag.Title = "Home Page";
}

<main>
    <div class="row">
        <section class="col-md-12" aria-labelledby="gettingStartedTitle">
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-12">
                            <div class="datatable-header-container sticky">
                                <button id="filter" class="btn btn-primary" data-bs-toggle="offcanvas" data-bs-target="#filterOffCanvas" aria-controls="filterOffCanvas">Filter</button>
                                <button id="add" class="btn btn-primary">Add</button>
                                <button id="edit" class="btn btn-primary">Edit</button>
                                <input type="search" id="search" class="form-control" placeholder="Search" />
                                <button id="export" class="btn btn-primary">Export</button>
                                <button id="email" class="btn btn-primary">Email</button>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <table id="test-table" class="w-100 dataTable nowrap">
                                
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
</main>

<div class="offcanvas offcanvas-start" tabindex="-1" id="filterOffCanvas" aria-labelledby="offcanvasExampleLabel">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="offcanvasExampleLabel">Offcanvas</h5>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        <div>
            Some text as placeholder. In real life you can have the elements you have chosen. Like, text, images, lists, etc.
        </div>
        <div class="dropdown mt-3">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown">
                Dropdown button
            </button>
            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <li><a class="dropdown-item" href="#">Action</a></li>
                <li><a class="dropdown-item" href="#">Another action</a></li>
                <li><a class="dropdown-item" href="#">Something else here</a></li>
            </ul>
        </div>
    </div>
</div>

@section scripts {
    <script>
        var table;
        $(document).ready(function () {
            table = $('#test-table').DataTable({ // Initialize DataTable on your table
                "ajax": {
                    "url": '@Url.Action("GetSUTest", "Home")', // The URL to the server-side data
                    "dataSrc": "", // Assuming the returned data is an array at the root level
                    "type": "GET", // Method type
                    "dataType": 'json' // Data type expected from the server
                },
                "dom": 'Bt', // Add the buttons to the DOM
                "buttons": [ // Define the buttons
                    {
                        extend: 'excelHtml5', // Extend the buttons
                        text: 'Export', // Button text
                        className: 'btn btn-success', // Button class
                        title: '', // Title of the Excel file
                        exportOptions: {
                            columns: [0, 1, 3, 4, 6, 7, 8, 9, 10, 11,], // Columns to export
                            format: {
                                body: function (data, row, column, node) {
                                    // Check for icons and replace with TRUE or FALSE
                                    if (data.indexOf('uis-check-circle') > -1) {
                                        return 'TRUE';
                                    } else if (data.indexOf('uis-times-circle') > -1) {
                                        return 'FALSE';
                                    }
                                    return data;
                                }
                            }
                        },
                        filename: 'HSU-Test-Data' // File name
                    }
                ],
                "serverSide": false, // Server-side processing
                "order": [[0, "asc"]], // Initial sorting column
                "paging": false, // Enable paging
                "searching": true, // Enable searching
                "columnDefs": [
                    { "title": "Club Name", "targets": 0 },
                    { "title": "Position", "targets": 1 },
                    { "title": "Name", "targets": 2 },
                    { "title": "Student Name", targets: 3 },
                    { "title": "Pref. Name", "targets": 4 },
                    { "title": "Contact", "targets": 5 },
                    { "title": "Phone", "targets": 6 },
                    { "title": "Email", "targets": 7 },
                    { "title": "Agreement", "targets": 8 },
                    { "title": "Training", "targets": 9 },
                    { "title": "Membership", "targets": 10 },
                    { "title": "Food", "targets": 11 },
                    { "className": "text-center", "targets": [8, 9, 10, 11] },
                    { "visible": false, "targets": [3, 4, 6, 7] }
                ],
                "columns": [ // Define columns and map them to data source properties
                    { "data": "Club_Name" },
                    { "data": "Position" },
                    {
                        "data": null,
                        "render": function (data, type, row) {
                            return `<label>Name: </label> <text class="float-end">${row.Student_Name}</text></br>
                                    <label>Pref: </label><text class="float-end">${row.Preferred_Name}</text>`;
                        }
                    },
                    { "data": "Student_Name" },
                    { "data": "Preferred_Name" },
                    {
                        "data": null,
                        "render": function (data, type, row) {
                            return `<label>Phone: </label><text class="float-end">${row.Phone_Number}</text></br>
                                    <label>Email: </label><text class="float-end">${row.Email_Address}</text>`;
                        }
                    },
                    { "data": "Phone_Number" },
                    { "data": "Email_Address" },
                    {
                        "data": "Agreement_Signed",
                        render: function (data) {
                            return convToIcon(data);
                        }
                    },
                    {
                        "data": "Training_Complete",
                        render: function (data) {
                            return convToIcon(data);
                        }
                    },
                    {
                        "data": "Membership_Purchased",
                        render: function (data) {
                            return convToIcon(data);
                        }
                    },
                    {
                        "data": "Food_Certified",
                        render: function (data) {
                            return convToIcon(data);
                        }
                    },
                ]
            });
        });

        $(document).on("click", "tbody tr", function (e) {
            $(e.target).closest('tr').toggleClass('clicked');
        });

        $(document).on("click", "#export", function () {
            table.button('.buttons-excel').trigger();
        });

        $(document).on("keyup", "#search", function () {
            table.search($(this).val()).draw();
        });

        function convToIcon(data) {
            return data === true ? '<i class="uis uis-check-circle"></i>' : '<i class="uis uis-times-circle"></i>';
        }
    </script>   
}